@model  IEnumerable<Webapp.Models.Equipment>
    @{
    ViewData["Title"] = " gerer equipement";
    } 
    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var message = @Html.Raw(Json.Serialize(TempData["SuccessMessage"]));
                showSuccessMessage("Équipement ajouté!", message, 3000);
            });
        </script>
    }
    @if (TempData["EditMessage"] != null)
    {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var message = @Html.Raw(Json.Serialize(TempData["EditMessage"]));
                showSuccessMessage("Équipement modifié!", message, 3000);
            });
        </script>
    }

    @Html.AntiForgeryToken()
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

<h2 class="text-center">Gérer les équipements</h2>  
   <div class="container mt-5">
    <div class="card shadow-lg p-4"> 
@if (User.IsInRole("Admin")){ 
    <div style="margin-bottom: 20px;">
        <div class="text-end">
            <a class="btn btn-success" asp-action="AjouterEquip"><i class="fas fa-plus"></i> Ajouter</a>
        </div>
    </div>
}
            <table class="table table-striped table-hover" id="EquipementTable">
                <thead>
                    <tr>
                <th>Numéro de Série Unique</th>
                <th>Type</th>
                <th>Marque</th>
                <th>Modele</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var equip in Model)
                {
                    <tr>
                        <td>@equip.NumeroSerie</td>
                        <td>@equip.Type</td>
                        <td>@equip.Marque</td>
                        <td>@equip.Modele</td>
                        <td> 
                            @if (User.IsInRole("Admin"))
                            {
                                <a asp-action="EditEquip" asp-route-id="@equip.Id" class="btn btn-light btn-sm"><i class="fas fa-edit"></i> Modifier</a>
                              <button data-id="@equip.Id" type="button" class="btn btn-light btn-sm delete-btn" >
                                            <i class="fas fa-trash"></i> Supprimer
                                        </button>
                            }
                            <a asp-action="DetailsEquip" asp-route-id="@equip.Id" class="btn btn-light btn-sm"><i class="fas fa-info-circle"></i> Détails</a> 
                            <a asp-action="HistoriqueEquipement" asp-route-id="@equip.Id" class="btn btn-light btn-sm"><i class="fas fa-history"></i> Historique</a>

                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="5" class="text-center">Aucun équipement disponible.</td></tr>
            }


        
   
        </tbody> 
        </table> 
<div style="margin-top: 10px;">
<a asp-action="index" class="btn btn-success"><i class="fas fa-arrow-left"></i> Retour </a>  
</div> 

    </div>
    </div> 
 @section Scripts { 
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#EquipementTable').DataTable({ 
                "language": {
                    "lengthMenu": "Afficher _MENU_ entrées",
                    "zeroRecords": "Aucun résultat trouvé",
                    "info": "Affichage de _START_ à _END_ sur _TOTAL_ entrées",
                    "infoEmpty": "Affichage de 0 à 0 sur 0 entrées",
                    "infoFiltered": "(filtré de _MAX_ entrées au total)",
                    "search": "Rechercher:",
                    "paginate": {
                        "first": "Premier",
                        "last": "Dernier",
                        "next": "Suivant",
                        "previous": "Précédent"
                    } 
                }
            });
        });
    </script>
<script>
document.addEventListener('DOMContentLoaded', function() { 
    if (typeof Swal === 'undefined') {
        console.error('SweetAlert2 n\'est pas chargé!');
        return;
    }
    const deleteButtons = document.querySelectorAll('.delete-btn');
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); 
            
            const equipmentId = this.getAttribute('data-id'); 
            
            Swal.fire({
                title: "Êtes-vous sûr?",
                text: "Vous ne pourrez pas annuler cette action!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Oui, supprimer!",
                cancelButtonText: "Annuler"
            }).then((result) => {
                if (result.isConfirmed) {
                    
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = `/Home/Supprime/${equipmentId}`; 
                    
                   const token = document.querySelector('input[name="__RequestVerificationToken"]').value;
                    const tokenInput = document.createElement('input');
                    tokenInput.type = 'hidden';
                    tokenInput.name = '__RequestVerificationToken';
                    tokenInput.value = token;
                    form.appendChild(tokenInput);
                    
                    document.body.appendChild(form);
                    Swal.fire({
                        title: "Supprimé!",
                        text: "L'équipement a été supprimé.",
                        icon: "success",
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        form.submit();
                    });
                    
                }
            });
        });
    });
});
</script>
}